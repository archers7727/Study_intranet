# 개발 환경 설정 가이드

## 목차
1. [사전 준비](#사전-준비)
2. [프로젝트 초기화](#프로젝트-초기화)
3. [Supabase 설정](#supabase-설정)
4. [데이터베이스 설정](#데이터베이스-설정)
5. [환경 변수 설정](#환경-변수-설정)
6. [개발 서버 실행](#개발-서버-실행)
7. [Vercel 배포](#vercel-배포)
8. [권장 개발 도구](#권장-개발-도구)

---

## 사전 준비

### 필수 도구 설치

1. **Node.js 20+ LTS**
```bash
# nvm 사용 권장
nvm install 20
nvm use 20
```

2. **pnpm (권장) 또는 npm**
```bash
npm install -g pnpm
```

3. **Git**
```bash
git --version
```

4. **VSCode (권장 IDE)**
- Extensions: Prisma, ESLint, Prettier, Tailwind CSS IntelliSense

### 계정 생성

1. **Supabase** (https://supabase.com)
   - GitHub 계정으로 로그인
   - 무료 프로젝트 생성 가능

2. **Vercel** (https://vercel.com)
   - GitHub 계정으로 로그인
   - 무료 배포 가능

---

## 프로젝트 초기화

### 1. Next.js 프로젝트 생성

```bash
# TypeScript, App Router, Tailwind CSS 포함
npx create-next-app@latest study-intranet --typescript --tailwind --app --src-dir --import-alias "@/*"

cd study-intranet
```

**선택 옵션:**
- ✅ TypeScript
- ✅ ESLint
- ✅ Tailwind CSS
- ✅ `src/` directory
- ✅ App Router
- ✅ Import alias (@/*)
- ❌ Turbopack (아직 안정화 단계)

### 2. 의존성 설치

```bash
# 핵심 라이브러리
pnpm add @prisma/client @supabase/supabase-js @supabase/auth-helpers-nextjs

# 개발 의존성
pnpm add -D prisma

# UI 라이브러리
pnpm add class-variance-authority clsx tailwind-merge lucide-react
pnpm add @radix-ui/react-dialog @radix-ui/react-dropdown-menu @radix-ui/react-select @radix-ui/react-tabs

# shadcn/ui 초기화 (선택)
npx shadcn-ui@latest init

# 폼 관리
pnpm add react-hook-form zod @hookform/resolvers

# 서버 상태 관리
pnpm add @tanstack/react-query

# 캘린더
pnpm add @fullcalendar/react @fullcalendar/daygrid @fullcalendar/timegrid @fullcalendar/interaction

# 날짜 처리
pnpm add date-fns

# 차트 (선택)
pnpm add recharts

# 파일 업로드
pnpm add react-dropzone
```

### 3. 프로젝트 구조 생성

```bash
mkdir -p src/{app,components,lib,hooks,types,utils}
mkdir -p src/components/{ui,forms,layouts}
mkdir -p src/app/api/{auth,students,classes,sessions,tags}
mkdir -p prisma
```

**권장 프로젝트 구조:**
```
study-intranet/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/             # 인증 관련 페이지
│   │   │   ├── login/
│   │   │   └── signup/
│   │   ├── (dashboard)/        # 대시보드 레이아웃
│   │   │   ├── students/
│   │   │   ├── classes/
│   │   │   ├── sessions/
│   │   │   ├── tags/
│   │   │   └── settings/
│   │   ├── api/                # API Routes
│   │   │   ├── auth/
│   │   │   ├── students/
│   │   │   ├── classes/
│   │   │   └── upload/
│   │   ├── layout.tsx
│   │   └── page.tsx
│   ├── components/
│   │   ├── ui/                 # shadcn/ui 컴포넌트
│   │   ├── forms/              # 폼 컴포넌트
│   │   ├── layouts/            # 레이아웃 컴포넌트
│   │   └── features/           # 기능별 컴포넌트
│   ├── lib/
│   │   ├── prisma.ts           # Prisma 클라이언트
│   │   ├── supabase.ts         # Supabase 클라이언트
│   │   └── auth.ts             # 인증 유틸
│   ├── hooks/                  # Custom Hooks
│   ├── types/                  # TypeScript 타입
│   └── utils/                  # 유틸 함수
├── prisma/
│   ├── schema.prisma
│   └── migrations/
├── public/
├── .env.local
└── package.json
```

---

## Supabase 설정

### 1. Supabase 프로젝트 생성

1. https://supabase.com 접속
2. "New Project" 클릭
3. 프로젝트 정보 입력:
   - Name: `study-intranet`
   - Database Password: 강력한 비밀번호 생성 (저장 필수!)
   - Region: `Northeast Asia (Seoul)` 선택
4. "Create new project" 클릭 (2-3분 소요)

### 2. API Keys 확인

프로젝트 대시보드 > Settings > API

- **Project URL**: `https://xxxxx.supabase.co`
- **anon public key**: 프론트엔드용 (공개 가능)
- **service_role key**: 백엔드용 (비공개, 관리자 권한)

### 3. Database 연결 정보 확인

Settings > Database > Connection string

**Connection pooling (권장):**
```
postgresql://postgres.[project-ref]:[password]@aws-0-ap-northeast-1.pooler.supabase.com:6543/postgres
```

---

## 데이터베이스 설정

### 1. Prisma 스키마 복사

이미 작성된 `schema.prisma` 파일을 `prisma/schema.prisma`로 복사합니다.

```bash
cp schema.prisma prisma/schema.prisma
```

### 2. Prisma 환경 설정

`prisma/schema.prisma` 파일에서 datasource url 수정:

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL") // 마이그레이션용
}
```

### 3. 데이터베이스 마이그레이션

```bash
# Prisma Client 생성
npx prisma generate

# 마이그레이션 파일 생성 및 적용
npx prisma migrate dev --name init

# Prisma Studio로 데이터 확인
npx prisma studio
```

### 4. Row Level Security (RLS) 설정 (중요!)

Supabase Dashboard > SQL Editor에서 실행:

```sql
-- users 테이블 RLS 활성화
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- 관리자만 전체 조회 가능
CREATE POLICY "Admins can view all users"
  ON users FOR SELECT
  USING (
    auth.uid() IN (
      SELECT id FROM users WHERE role_level = 'ADMIN'
    )
  );

-- 본인 데이터는 조회 가능
CREATE POLICY "Users can view own data"
  ON users FOR SELECT
  USING (auth.uid() = id);

-- students 테이블 RLS
ALTER TABLE students ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Teachers can view all students"
  ON students FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM users
      WHERE users.id = auth.uid()
      AND users.role_level IN ('ADMIN', 'SENIOR_TEACHER', 'TEACHER')
    )
  );

CREATE POLICY "Students can view own data"
  ON students FOR SELECT
  USING (user_id = auth.uid());

-- 추가 테이블도 동일한 패턴으로 RLS 설정
```

---

## 환경 변수 설정

### 1. `.env.local` 파일 생성

```bash
# .env.local

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Database (Prisma)
DATABASE_URL=postgresql://postgres.[project-ref]:[password]@aws-0-ap-northeast-1.pooler.supabase.com:6543/postgres?pgbouncer=true
DIRECT_URL=postgresql://postgres.[project-ref]:[password]@aws-0-ap-northeast-1.pooler.supabase.com:5432/postgres

# NextAuth (선택)
NEXTAUTH_SECRET=your-random-secret-string
NEXTAUTH_URL=http://localhost:3000

# File Upload (Supabase Storage)
NEXT_PUBLIC_STORAGE_BUCKET=materials

# App Settings
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 2. `.env.example` 파일 생성 (Git 포함)

```bash
cp .env.local .env.example
```

`.env.example`에서 실제 값은 제거하고 템플릿만 유지:

```bash
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
# ...
```

### 3. `.gitignore` 확인

```gitignore
# .env 파일
.env*.local
.env

# Prisma
prisma/*.db
prisma/*.db-journal

# Node modules
node_modules/
```

---

## 개발 서버 실행

### 1. Prisma Client 생성

```bash
npx prisma generate
```

### 2. 개발 서버 시작

```bash
pnpm dev
```

브라우저에서 http://localhost:3000 접속

### 3. 초기 데이터 시딩 (선택)

`prisma/seed.ts` 파일 생성:

```typescript
import { PrismaClient, RoleLevel } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  // 관리자 생성
  const admin = await prisma.user.create({
    data: {
      email: 'admin@example.com',
      name: '관리자',
      roleLevel: RoleLevel.ADMIN,
      teacher: {
        create: {
          name: '관리자',
          phone: '010-1234-5678',
          specialties: ['전체'],
        },
      },
    },
  })

  // 기본 태그 생성
  const tags = await prisma.tag.createMany({
    data: [
      { name: '수학', color: '#3B82F6', category: '과목' },
      { name: '영어', color: '#10B981', category: '과목' },
      { name: '초급', color: '#F59E0B', category: '수준' },
      { name: '중급', color: '#8B5CF6', category: '수준' },
      { name: '고급', color: '#EF4444', category: '수준' },
    ],
  })

  console.log('Seeding completed!', { admin, tags })
}

main()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
```

`package.json`에 스크립트 추가:

```json
{
  "prisma": {
    "seed": "ts-node --compiler-options {\"module\":\"CommonJS\"} prisma/seed.ts"
  }
}
```

실행:

```bash
pnpm add -D ts-node
npx prisma db seed
```

---

## Vercel 배포

### 1. GitHub 레포지토리 연결

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/yourusername/study-intranet.git
git push -u origin main
```

### 2. Vercel 프로젝트 생성

1. https://vercel.com 접속
2. "Add New Project" 클릭
3. GitHub 레포지토리 선택
4. Framework Preset: Next.js 자동 감지
5. 환경 변수 추가:
   - `.env.local`의 모든 변수 복사
   - `NEXT_PUBLIC_APP_URL`은 Vercel URL로 변경
6. "Deploy" 클릭

### 3. 도메인 연결 (선택)

Vercel Dashboard > Settings > Domains

- 커스텀 도메인 추가
- DNS 설정 (A 레코드 또는 CNAME)

### 4. 자동 배포 설정

- `main` 브랜치 푸시 시 자동 배포
- PR 생성 시 Preview 배포

---

## 권장 개발 도구

### VSCode Extensions

```json
{
  "recommendations": [
    "prisma.prisma",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "github.copilot",
    "usernamehw.errorlens"
  ]
}
```

`.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "[prisma]": {
    "editor.defaultFormatter": "Prisma.prisma"
  }
}
```

### Prettier 설정

`.prettierrc`:

```json
{
  "semi": false,
  "singleQuote": true,
  "trailingComma": "es5",
  "printWidth": 80,
  "tabWidth": 2,
  "plugins": ["prettier-plugin-tailwindcss"]
}
```

### ESLint 설정

`.eslintrc.json`:

```json
{
  "extends": [
    "next/core-web-vitals",
    "prettier"
  ],
  "rules": {
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error"
  }
}
```

### TypeScript 설정 강화

`tsconfig.json`:

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

---

## 개발 워크플로우

### 1. 기능 개발

```bash
# 새 브랜치 생성
git checkout -b feature/student-management

# 개발 진행...

# 커밋
git add .
git commit -m "feat: Add student CRUD operations"

# 푸시 및 PR
git push origin feature/student-management
```

### 2. 데이터베이스 스키마 변경

```bash
# schema.prisma 수정 후
npx prisma migrate dev --name add_xxx_field

# 프로덕션 적용
npx prisma migrate deploy
```

### 3. 타입 생성

```bash
# Prisma 타입 재생성
npx prisma generate

# TypeScript 타입 체크
pnpm tsc --noEmit
```

---

## 트러블슈팅

### Prisma 연결 오류

```bash
# Prisma Client 재생성
npx prisma generate

# 캐시 삭제
rm -rf node_modules/.prisma
pnpm install
```

### Supabase 연결 오류

- API Keys 확인
- 프로젝트 일시 중지 상태 확인 (7일 미사용 시 일시 중지)
- RLS 정책 확인

### Vercel 배포 오류

- 환경 변수 확인
- Build 로그 확인
- `DATABASE_URL`에 `?pgbouncer=true` 추가 확인

---

## 다음 단계

1. **UI 컴포넌트 개발**: shadcn/ui로 기본 컴포넌트 구축
2. **인증 시스템**: Supabase Auth 연동
3. **API 개발**: `/api` 라우트 구현
4. **페이지 개발**: 학생, 클래스, 세션 관리 페이지
5. **테스트**: E2E 테스트 작성 (Playwright)
6. **배포**: Vercel Production 배포

**개발 우선순위:**
1. 인증 및 권한 시스템
2. 학생 관리 (CRUD)
3. 클래스 관리
4. 세션 및 출석 관리
5. 과제 시스템
6. 태그 및 검색

---

## 참고 자료

- **Next.js**: https://nextjs.org/docs
- **Prisma**: https://www.prisma.io/docs
- **Supabase**: https://supabase.com/docs
- **shadcn/ui**: https://ui.shadcn.com
- **Tailwind CSS**: https://tailwindcss.com/docs
- **TanStack Query**: https://tanstack.com/query/latest
